"use strict";function y(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=u(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){l=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(l)throw i}}}}function u(e,t){if(e){if("string"==typeof e)return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var r=require("css"),s=require("extend"),o={mediaQuery:[{mediaType:"(max-width: 1280px)",ratio:.5},{mediaType:"(min-width: 1281px) and (max-width: 1920px)",ratio:1},{mediaType:"(min-width: 1921px)",ratio:1.5}],remUnit:75,remPrecision:6,forcePxComment:"px",forceRemComment:"rem",keepComment:"no",autoDealPx:["font-size"],autoDealNo:["border-radius","border","box-shadow","min-width","min-height","max-width","max-height"],appendAutoDealPx:[],appendAutoDealNo:[]},v=/\b(\d+(\.\d+)?)px\b/;function e(e){this.config={},s(this.config,o,e);var t=this.config,r=t.appendAutoDealPx,a=t.autoDealPx,n=t.appendAutoDealNo,i=t.autoDealNo;l(a,r),l(i,n)}function h(e){return e&&Array.isArray(e)&&0<e.length}function l(e,t){if(h(e)&&h(t)){var r,a=y(t);try{for(a.s();!(r=a.n()).done;){var n=r.value;e.includes(n)||e.push(n)}}catch(e){a.e(e)}finally{a.f()}}}function g(e,l,u,c){e.forEach(function(e){var t={};s(!0,t,l),t.value=c._getCalcValue("px",t.value,e.ratio);var r,a,n=!1,i=y(e.rules);try{for(i.s();!(r=i.n()).done;){var o=r.value;JSON.stringify(o.selectors)===JSON.stringify(u.selectors)&&(o.declarations.push(t),n=!0)}}catch(e){i.e(e)}finally{i.f()}n||(a={type:"rule",selectors:u.selectors,declarations:[t]},e.rules.push(a))})}e.prototype.generateRem=function(e){var p=this,m=p.config,t=r.parse(e),d=m.mediaQuery.map(function(e){return{type:"media",media:e.mediaType,ratio:e.ratio,rules:[]}});return function e(t,r){for(var a=0;a<t.length;a++){var n=t[a];if("media"!==n.type)if("keyframes"!==n.type){if("rule"===n.type||"keyframe"===n.type){for(var i=n.declarations,o=0;o<i.length;o++){var l=i[o];if("declaration"===l.type&&v.test(l.value)){var u=i[o+1];if(u&&"comment"===u.type)if(u.comment.trim()===m.forcePxComment){if("0px"===l.value){l.value="0",i.splice(o+1,1);continue}r?(l.value=p._getCalcValue("rem",l.value),i.splice(o+1,1)):(g(d,l,n,p),i.splice(o,2),o--)}else if(u.comment.trim()===m.keepComment)i.splice(o+1,1);else if(u.comment.trim()===m.forceRemComment)l.value=p._getCalcValue("rem",l.value),i.splice(o+1,1);else if(m.autoDealPx.includes(l.property)){if("0px"===l.value){l.value="0";continue}r?l.value=p._getCalcValue("rem",l.value):(g(d,l,n,p),i.splice(o,1),o--)}else m.autoDealNo.includes(l.property)||(l.value=p._getCalcValue("rem",l.value));else if(m.autoDealPx.includes(l.property)){if("0px"===l.value){l.value="0";continue}r?l.value=p._getCalcValue("rem",l.value):(g(d,l,n,p),i.splice(o,1),o--)}else m.autoDealNo.includes(l.property)||(l.value=p._getCalcValue("rem",l.value))}}t[a].declarations.length||(t.splice(a,1),a--)}}else e(n.keyframes,!0);else e(n.rules,!0)}if(!r){var c,s=y(d);try{for(s.s();!(c=s.n()).done;){var f=c.value;f&&h(f.rules)&&t.push(f)}}catch(e){s.e(e)}finally{s.f()}}}(t.stylesheet.rules),r.stringify(t)},e.prototype._getCalcValue=function(r,e,a){var n=this.config,t=new RegExp(v.source,"g");function i(e){return 0==(e=parseFloat(e.toFixed(n.remPrecision)))?e:e+r}return e.replace(t,function(e,t){return i("px"===r?t*a:t/n.remUnit)})},module.exports=e;