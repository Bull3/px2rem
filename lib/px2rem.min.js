"use strict";function v(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=u(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){l=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw o}}}}function u(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var r=require("css"),s=require("extend"),i={mediaQuery:[{mediaType:"(max-width: 1280px)",ratio:.5},{mediaType:"(min-width: 1281px) and (max-width: 1920px)",ratio:1},{mediaType:"(min-width: 1921px)",ratio:1.5}],remUnit:75,remPrecision:6,forcePxComment:"px",forceRemComment:"rem",keepComment:"no",autoDealPx:["font-size"],autoDealNo:["border","shadow","min","max"],appendAutoDealPx:[],appendAutoDealNo:[]},d=/\b(\d+(\.\d+)?)px\b/;function e(e){this.config={},s(this.config,i,e);var t=this.config,r=t.appendAutoDealPx,n=t.autoDealPx,a=t.appendAutoDealNo,o=t.autoDealNo;l(n,r),l(o,a)}function h(e){return e&&Array.isArray(e)&&0<e.length}function l(e,t){if(h(e)&&h(t)){var r,n=v(t);try{for(n.s();!(r=n.n()).done;){var a=r.value;e.includes(a)||e.push(a)}}catch(e){n.e(e)}finally{n.f()}}}function g(e,l,u,c){e.forEach(function(e){var t={};s(!0,t,l),t.value=c._getCalcValue("px",t.value,e.ratio);var r,n,a=!1,o=v(e.rules);try{for(o.s();!(r=o.n()).done;){var i=r.value;JSON.stringify(i.selectors)===JSON.stringify(u.selectors)&&(i.declarations.push(t),a=!0)}}catch(e){o.e(e)}finally{o.f()}a||(n={type:"rule",selectors:u.selectors,declarations:[t]},e.rules.push(n))})}function x(e,t,r){return r.config[e].some(function(e){return t.includes(e)})}e.prototype.generateRem=function(e){var p=this,m=p.config,t=r.parse(e),y=m.mediaQuery.map(function(e){return{type:"media",media:e.mediaType,ratio:e.ratio,rules:[]}});return function e(t,r){for(var n=0;n<t.length;n++){var a=t[n];if("media"!==a.type)if("keyframes"!==a.type){if("rule"===a.type||"keyframe"===a.type){for(var o=a.declarations,i=0;i<o.length;i++){var l=o[i];if("declaration"===l.type&&d.test(l.value)){var u=o[i+1];if(u&&"comment"===u.type)if(u.comment.trim()===m.forcePxComment){if("0px"===l.value){l.value="0",o.splice(i+1,1);continue}r?(l.value=p._getCalcValue("rem",l.value),o.splice(i+1,1)):(g(y,l,a,p),o.splice(i,2),i--)}else if(u.comment.trim()===m.keepComment)o.splice(i+1,1);else if(u.comment.trim()===m.forceRemComment)l.value=p._getCalcValue("rem",l.value),o.splice(i+1,1);else if(x("autoDealPx",l.property,p)){if("0px"===l.value){l.value="0";continue}r?l.value=p._getCalcValue("rem",l.value):(g(y,l,a,p),o.splice(i,1),i--)}else x("autoDealNo",l.property,p)||(l.value=p._getCalcValue("rem",l.value));else if(x("autoDealPx",l.property,p)){if("0px"===l.value){l.value="0";continue}r?l.value=p._getCalcValue("rem",l.value):(g(y,l,a,p),o.splice(i,1),i--)}else x("autoDealNo",l.property,p)||(l.value=p._getCalcValue("rem",l.value))}}t[n].declarations.length||(t.splice(n,1),n--)}}else e(a.keyframes,!0);else e(a.rules,!0)}if(!r){var c,s=v(y);try{for(s.s();!(c=s.n()).done;){var f=c.value;f&&h(f.rules)&&t.push(f)}}catch(e){s.e(e)}finally{s.f()}}}(t.stylesheet.rules),r.stringify(t)},e.prototype._getCalcValue=function(r,e,n){var a=this.config,t=new RegExp(d.source,"g");function o(e){return 0==(e=parseFloat(e.toFixed(a.remPrecision)))?e:e+r}return e.replace(t,function(e,t){return o("px"===r?t*n:t/a.remUnit)})},module.exports=e;